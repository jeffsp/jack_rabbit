<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Jack Rabbit: raster_example1.cc</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Jack Rabbit
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">raster_example1.cc</div>  </div>
</div><!--header-->
<div class="contents">
<p>This is a detailed example of using subregion iterators and raster function objects in order to create a raster that contains an image: </p>
<div class="image">
<img src="raster_example1.png" alt="raster_example1.png"/>
<div class="caption">
raster example1 output</div></div>
<div class="fragment"><pre class="fragment">





<span class="preprocessor">#include &quot;<a class="code" href="raster_8h.html" title="raster container adapter">raster.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="subscript__function_8h.html" title="functions that use raster subscripts">subscript_function.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="subregion__algo_8h.html" title="subregion algorithms">subregion_algo.h</a>&quot;</span>
<span class="preprocessor">#include &lt;algorithm&gt;</span>
<span class="preprocessor">#include &lt;boost/lambda/lambda.hpp&gt;</span>
<span class="preprocessor">#include &lt;cmath&gt;</span>
<span class="preprocessor">#include &lt;complex&gt;</span>
<span class="preprocessor">#include &lt;fstream&gt;</span>
<span class="preprocessor">#include &lt;iostream&gt;</span>

<span class="keyword">using namespace </span>boost::lambda;
<span class="keyword">using namespace </span>jack_rabbit;
<span class="keyword">using namespace </span>std;

<span class="comment">// Affine transformation helper</span>
<span class="keyword">class </span>Affine
{
    <span class="keyword">public</span>:
    Affine ()
        : t_ (0), s_ (1)
    { }
    <span class="comment">// Translate by &#39;t&#39; and scale by &#39;s&#39;</span>
    Affine (<span class="keywordtype">float</span> t, <span class="keywordtype">float</span> s)
        : t_ (t), s_ (s)
    { }
    <span class="keywordtype">float</span> To (<span class="keywordtype">size_t</span> x)<span class="keyword"> const</span>
<span class="keyword">    </span>{ <span class="keywordflow">return</span> t_ + x * s_; }
    <span class="keywordtype">size_t</span> From (<span class="keywordtype">float</span> x)<span class="keyword"> const</span>
<span class="keyword">    </span>{ <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span> ((x - t_) / s_); }
    <span class="keyword">private</span>:
    <span class="keywordtype">float</span> t_, s_;
};

<span class="comment">// Mandelbrot function object:</span>
<span class="comment">// Map the Mandelbrot set onto a raster</span>
<span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<span class="keyword">class </span>Mandelbrot
{
    <span class="keyword">public</span>:
    Mandelbrot (<span class="keywordtype">size_t</span> <span class="comment">/*r*/</span>, <span class="keywordtype">size_t</span> <span class="comment">/*c*/</span>) { }
    <span class="comment">// Define coordinate mapping</span>
    <span class="keywordtype">void</span> CoordMap (<span class="keyword">const</span> Affine &amp;ax, <span class="keyword">const</span> Affine &amp;ay)
    { ax_ = ax; ay_ = ay; }
    <span class="comment">// Remap coordinate (r, c), and then determine if it&#39;s</span>
    <span class="comment">// in the set or not.</span>
    T operator() (<span class="keywordtype">size_t</span> r, <span class="keywordtype">size_t</span> c)<span class="keyword"> const</span>
<span class="keyword">    </span>{
        <span class="comment">// Remap x and y</span>
        complex&lt;float&gt; z (ax_.To (c), ay_.To (r));
        complex&lt;float&gt; k (z);
        <span class="keywordtype">size_t</span> count = 0;
        <span class="comment">// Iterate until we are kindof sure that the point</span>
        <span class="comment">// is in the set, or until the point is sure to</span>
        <span class="comment">// shoot off to infinity...</span>
        <span class="keywordflow">while</span> (++count != ITER)
        {
            z = z * z + k;
            <span class="keywordflow">if</span> (norm (z) &gt; 4.0)
                <span class="comment">// ... definitely not in the set</span>
                <span class="keywordflow">return</span> OUT;
        }
        <span class="comment">// ... probably in the set.</span>
        <span class="keywordflow">return</span> IN;
    }
    <span class="keyword">private</span>:
    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> ITER = 500;
    <span class="keyword">static</span> <span class="keyword">const</span> T IN = 0;
    <span class="keyword">static</span> <span class="keyword">const</span> T OUT = 255;
    Affine ax_, ay_;
};

<span class="comment">// PGM file writer helper</span>
<span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<span class="keywordtype">void</span> WritePGM (<span class="keyword">const</span> T &amp;m, ofstream &amp;ofs)
{
    <span class="comment">// Write a pgm header</span>
    ofs &lt;&lt; <span class="stringliteral">&quot;P5\n&quot;</span>
        &lt;&lt; <span class="stringliteral">&quot;# Raster Example\n&quot;</span>
        &lt;&lt; m.cols () &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; m.rows () &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
        &lt;&lt; <span class="stringliteral">&quot;255\n&quot;</span>;

    <span class="comment">// Transform to a vector of chars</span>
    vector&lt;char&gt; mm (m.begin (), m.end ());

    <span class="comment">// Write the pgm pixels</span>
    <span class="keyword">const</span> std::streamsize sz =
        <span class="keyword">static_cast&lt;</span>std::streamsize<span class="keyword">&gt;</span> (mm.size ());
    ofs.write (&amp;mm[0], sz);
}

<span class="keywordtype">int</span> main ()
{
    <span class="keywordflow">try</span>
    {
        <span class="keyword">const</span> <span class="keywordtype">size_t</span> M = 256;
        <span class="keyword">const</span> <span class="keywordtype">size_t</span> N = 256;

        clog &lt;&lt; <span class="stringliteral">&quot;Generating a &quot;</span> &lt;&lt; M &lt;&lt; <span class="stringliteral">&quot;X&quot;</span> &lt;&lt; N
            &lt;&lt; <span class="stringliteral">&quot; image...&quot;</span> &lt;&lt; endl;

        <span class="keyword">typedef</span> <a name="_a0"></a><a class="code" href="classjack__rabbit_1_1raster.html" title="raster container adapter">raster&lt;int&gt;</a> Image;

        <span class="comment">// Some matrices that will contain our images</span>
        Image m0 (M, N);
        Image m1 (M / 3, N / 3);

        <span class="comment">// Our Mandelbrot functions</span>
        <a name="_a1"></a><a class="code" href="classjack__rabbit_1_1subscript__generator.html" title="Generating subscript function.">subscript_generator&lt;Image::value_type,Mandelbrot&gt;</a>
        mandel0 (m0.rows (), m0.cols ());
        Affine ax0 (-2.2f, 3.0f / m0.rows ());
        Affine ay0 (-1.7f, 3.0f / m0.rows ());
        mandel0.CoordMap (ax0, ay0);

        <a class="code" href="classjack__rabbit_1_1subscript__generator.html" title="Generating subscript function.">subscript_generator&lt;Image::value_type,Mandelbrot&gt;</a>
        mandel1 (m1.rows (), m1.cols ());
        Affine ax1 (-0.28f, 0.30f / m1.rows ());
        Affine ay1 (-0.92f, 0.30f / m1.rows ());
        mandel1.CoordMap (ax1, ay1);

        <span class="comment">// Create the main image</span>
        generate (m0.begin (), m0.end (), mandel0);

        <span class="comment">// Lower contrast of the region to zoom</span>
        <span class="keywordtype">size_t</span> r1 = ay0.From (ay1.To (0));
        <span class="keywordtype">size_t</span> c1 = ax0.From (ax1.To (0));
        <span class="keywordtype">size_t</span> r2 = ay0.From (ay1.To (m1.rows ()));
        <span class="keywordtype">size_t</span> c2 = ax0.From (ax1.To (m1.cols ()));
        <a name="_a2"></a><a class="code" href="structjack__rabbit_1_1subregion.html" title="Rectangular subregion.">subregion</a> s0 = m0.sub (
            static_cast&lt;int&gt; (r1), static_cast&lt;int&gt; (c1),
            r2 - r1, c2 - c1);
        for_each (m0.begin (s0), m0.end (s0),
            _1 = (_1 - 127) / 2 + 127);

        <span class="comment">// Create the zoomed image</span>
        generate (m1.begin (), m1.end (), mandel1);
        <span class="comment">// Copy the zoomed image to the main image...</span>
        <a class="code" href="structjack__rabbit_1_1subregion.html" title="Rectangular subregion.">subregion</a> s1 = { m0.<a name="a3"></a><a class="code" href="structjack__rabbit_1_1subregion.html#a1cf6ddc9bd7d8a96b0080b55043ab2c0" title="Dimensions of the subregion.">rows</a> () / 9, m0.rows () / 9,
            m1.rows (), m1.cols () };
        <a name="a4"></a><a class="code" href="namespacejack__rabbit.html#a080eceb7b1e9a81be97490104b62e82a" title="Overload for fast subregion copies.">copy</a> (m1.begin (), m1.end (), m0.begin (s1));

        <span class="comment">// Lower contrast of the zoomed image</span>
        transform (m0.begin (s1), m0.end (s1), m0.begin (s1),
            (_1 - 127) / 2 + 127);

        <span class="comment">// Save the image to a file</span>
        <span class="keyword">const</span> <span class="keywordtype">string</span> fn (<span class="stringliteral">&quot;raster_example1.pgm&quot;</span>);
        clog &lt;&lt; <span class="stringliteral">&quot;Writing image to &quot;</span> &lt;&lt; fn &lt;&lt; <span class="stringliteral">&quot;...&quot;</span> &lt;&lt; endl;

        ofstream ofs (fn.c_str ());
        <span class="keywordflow">if</span> (!ofs)
            <span class="keywordflow">throw</span> std::runtime_error (<span class="stringliteral">&quot;Could not open file for writing&quot;</span>);

        WritePGM (m0, ofs);

        <span class="keywordflow">return</span> 0;
    }
    <span class="keywordflow">catch</span> (<span class="keyword">const</span> exception &amp;e)
    {
        cerr &lt;&lt; e.what () &lt;&lt; endl;
        <span class="keywordflow">return</span> -1;
    }
}
</pre></div> </div><!-- contents -->
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Thu May 22 2014 20:57:31 for Jack Rabbit by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
